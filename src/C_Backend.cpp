#include "C_Backend.hpp"

namespace C
{
  void generate(string outputStem, bool keep)
  {
    string cName = outputStem + ".c";
    string exeName = outputStem + ".exe";
    ofstream c(cName);
    c << "//--- " << outputStem << ".c, generated by the Onyx Compiler ---//\n\n";
    genCommon(c);
    genTypeDecls(c);
    genGlobals(c);
    genSubroutines(c);
    c.close();
    string cmd = string("gcc") + " --std=c99 -o " + exeName + ' ' + cName + " &> /dev/null";
    //wait for cc to terminate
    int exitStatus = system(cmd.c_str());
    if(!keep)
    {
      remove(cName.c_str());
    }
    if(exitStatus)
    {
      ERR_MSG("C compiler encountered error.");
    }
  }

  void genCommon(ostream& c)
  {
  }

  void genTypeDecls(ostream& c)
  {
  }

  void genGlobals(ostream& c)
  {
  }

  void genSubroutines(ostream& c)
  {
  }
}

